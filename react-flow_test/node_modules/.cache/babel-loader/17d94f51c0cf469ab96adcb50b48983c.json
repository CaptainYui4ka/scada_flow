{"ast":null,"code":"var _jsxFileName = \"C:\\\\\\u0423\\u0447\\u0435\\u0431\\u0430\\\\project\\\\\\u0434\\u0438\\u043F\\u043B\\u043E\\u043C\\\\react-flow\\\\react-flow_test\\\\src\\\\react-flow-renderer\\\\index.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport \"./styles.css\";\nimport ReactFlow, { removeElements, updateEdge, addEdge, Background, MiniMap, Controls, useZoomPanHelper } from 'react-flow-renderer';\nimport localforage from 'localforage';\nimport { nodeTypes } from './Nodes';\nimport styleConnect from './style-connect';\nimport Message from '../messages/message';\nimport { Modal } from 'bootstrap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = new WebSocket('ws://localhost:5000/', \"protocolOne\");\nlocalforage.config({\n  name: 'react-flow-docs',\n  storeName: 'flows'\n});\n\nconst ReactFlowRenderer = () => {\n  _s();\n\n  const [elements, setElements] = useState([styleConnect]);\n  const [name, setName] = useState(\"\");\n  const [activeNode, setActiveNode] = useState();\n  const [newName, setNewName] = useState(\"\");\n  const [instance, setInstance] = useState();\n  const [connected, setConnected] = useState(false);\n  const {\n    transform\n  } = useZoomPanHelper(); //const [ nodes, setNodes, onNodesChange ] = useNodesState(initialNodes);\n\n  const data = 'example-flow'; //получение данных с localStorage\n\n  const getPosition = () => {\n    const getPos = localStorage.getItem(\"Position\");\n    console.log('Position', JSON.parse(getPos)); //this.setState({ activeNode: JSON.parse(getPos)})\n  };\n\n  useEffect(() => {\n    if (activeNode) setNewName(activeNode.data.label);\n  }, [activeNode]);\n\n  const elementRemoveHandler = elementTobeRemoved => {\n    setElements(prev => removeElements(elementTobeRemoved, prev));\n  };\n\n  const connectHandler = params => {\n    setElements(els => addEdge({ ...params,\n      type: 'smoothstep',\n      style: {\n        stroke: '#FF0000'\n      },\n      animated: true\n    }, els));\n  };\n\n  const addRectangleHandler = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      data: {\n        label: `${name}`\n      },\n      type: \"rectangle\",\n      position: {\n        x: Math.random() * window.innerWidth,\n        y: Math.random() * window.innerHeight\n      }\n    };\n    newNode.data = { ...newNode.data,\n      id: `${newNode.id}`\n    };\n    setElements(prev => {\n      return [...prev, newNode];\n    });\n    setName(\"\");\n  };\n\n  const addCircleHandler = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      data: {\n        label: `${name}`\n      },\n      type: \"circle\",\n      position: {\n        x: Math.random() * window.innerWidth,\n        y: Math.random() * window.innerHeight\n      }\n    };\n    newNode.data = { ...newNode.data,\n      id: `${newNode.id}`\n    };\n    setElements(prev => {\n      return [...prev, newNode];\n    });\n    setName(\"\");\n  };\n\n  const addTriangleHandler = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      data: {\n        label: `${name}`\n      },\n      type: \"triangle\",\n      position: {\n        x: Math.random() * window.innerWidth,\n        y: Math.random() * window.innerHeight\n      }\n    };\n    newNode.data = { ...newNode.data,\n      id: `${newNode.id}`\n    };\n    setElements(prev => {\n      return [...prev, newNode];\n    });\n    setName(\"\");\n  };\n\n  const addTextHandler = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      data: {\n        label: `${name}`\n      },\n      type: \"text\",\n      position: {\n        x: 0,\n        y: 0\n      }\n    };\n    newNode.data = { ...newNode.data,\n      id: `${newNode.id}`\n    };\n    setElements(prev => {\n      return [...prev, newNode];\n    });\n    setName(\"\");\n  };\n\n  const edgeUpdateHandler = (oldEdge, newConnection) => setElements(els => updateEdge(oldEdge, newConnection, els));\n\n  const clickHandler = e => {\n    var htmlString = e.target.outerHTML.toString();\n    var index = htmlString.indexOf(` id=\"`);\n    index += 5;\n    const currentId = htmlString.substr(index, 13);\n    elements.forEach(_current => {\n      if (_current.id === currentId) {\n        setActiveNode(_current);\n      }\n    }); // setNewName(activeNode.data.label)\n  };\n\n  const updateNodeHandler = () => {\n    if (!activeNode) return;\n    setElements(elements.map(_current => {\n      if (_current.id === activeNode.id) {\n        return { ..._current,\n          data: {\n            label: newName,\n            id: _current.data.id\n          }\n        };\n      }\n\n      return _current;\n    }));\n  };\n\n  const onLoad = reactFlowInstance => {\n    setInstance(reactFlowInstance);\n    reactFlowInstance.fitView();\n  };\n\n  const onRestore = useCallback(() => {\n    const restoreFlow = async () => {\n      const flow = await localforage.getItem(position);\n\n      if (flow) {\n        const [x = 0, y = 0] = flow.position;\n        setElements(flow.elements || []);\n        transform({\n          x,\n          y,\n          zoom: flow.zoom || 0\n        });\n      }\n    };\n\n    restoreFlow();\n  }, [setElements, transform]);\n\n  socket.onopen = () => {\n    setConnected(true);\n    console.log('подключено');\n  };\n  /*\r\n  socket.onmessage = (event) => {\r\n      console.log('есть сообщение')\r\n      const lineSignal = JSON.parse(event.data);\r\n      console.log(lineSignal);\r\n      let linedate = event.data;\r\n      console.log(linedate);\r\n      let json = JSON.stringify(linedate);\r\n      console.log(json);\r\n      let fileName = 'signal.json'\r\n        let fileToSave = new Blob([JSON.stringify(json, null, 4)], {\r\n          type: 'application/json',\r\n          name: fileName\r\n      })\r\n      saveAs (fileToSave, fileName);\r\n  }\r\n  */\n\n\n  socket.onmessage = event => {\n    let msg = JSON.parse(event.data);\n    console.log('есть сообщение');\n    console.log(msg);\n    localStorage.setItem(\"data\", JSON.stringify(msg));\n  };\n\n  const signalSocket = msg => {\n    console.log(signalSocket.msg);\n    console.log(signalSocket.msg);\n    console.log(signalSocket.msg);\n  }; //save pos\n\n\n  const saveChangesHandler = () => {\n    console.log(\"state\", instance.getElements()); //сохранение в локальное хранилище\n    //localStorage.setItem('Position', JSON.stringify(instance.getElements()));\n\n    localforage.setItem(position, JSON.stringify(instance.getElements())); //отправка json\n\n    let pos = JSON.stringify(instance.getElements());\n    socket.send(pos);\n  };\n\n  socket.onclose = function (event) {\n    if (event.wasClean) {\n      console.log('Соединение закрыто чисто');\n    } else {\n      console.log('Обрыв соединения');\n    }\n\n    console.log('Код: ' + event.code + ' причина: ' + event.reason);\n  };\n\n  socket.onerror = function (event) {\n    console.log(event);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: \"75vh\",\n      width: \"75vw\",\n      border: \"1px solid black\",\n      marginLeft: \"12.5vw\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(ReactFlow, {\n      elements: elements,\n      onElementsRemove: elementRemoveHandler,\n      onConnect: connectHandler,\n      deleteKeyCode: 8 || 46,\n      onEdgeUpdate: edgeUpdateHandler,\n      nodeTypes: nodeTypes,\n      snapToGrid: true,\n      snapGrid: [16, 16],\n      connectionLineStyle: {\n        stroke: \"black\",\n        strokeWidth: 2\n      },\n      onDoubleClick: clickHandler,\n      onLoad: onLoad,\n      children: [/*#__PURE__*/_jsxDEV(Background, {\n        variant: \"dots\",\n        gap: 15,\n        size: 2,\n        color: \"#c8c8c8\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(MiniMap, {\n        nodeColor: node => {\n          switch (node.type) {\n            case \"rectangle\":\n              return \"red\";\n\n            case \"circle\":\n              return \"#00ff00\";\n\n            case \"triangle\":\n              return \"rgb(0,0,255)\";\n\n            default:\n              return \"#eee\";\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        value: name,\n        onChange: e => setName(e.target.value),\n        type: \"text\",\n        placeholder: \"Enter new node name\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: addRectangleHandler,\n        children: \"Create Rectangle\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: addCircleHandler,\n        children: \"Create Circle\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: addTriangleHandler,\n        children: \"Create Triangle\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: addTextHandler,\n        children: \"Plain text\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        value: newName,\n        onChange: e => setNewName(e.target.value),\n        type: \"text\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: updateNodeHandler,\n        children: \"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0441\\u043E\\u0441\\u0442\\u043E\\u044F\\u043D\\u0438\\u0435 \\u0444\\u0438\\u0433\\u0443\\u0440\\u044B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: saveChangesHandler,\n        children: \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0435\\u043D\\u0438\\u0435\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: onRestore,\n        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Message, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 244,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ReactFlowRenderer, \"29sSypn8Vqv6U1zt8SVXrw6HGpY=\", false, function () {\n  return [useZoomPanHelper];\n});\n\n_c = ReactFlowRenderer;\nexport default ReactFlowRenderer;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReactFlowRenderer\");","map":{"version":3,"sources":["C:/Учеба/project/диплом/react-flow/react-flow_test/src/react-flow-renderer/index.jsx"],"names":["React","useState","useEffect","useCallback","ReactFlow","removeElements","updateEdge","addEdge","Background","MiniMap","Controls","useZoomPanHelper","localforage","nodeTypes","styleConnect","Message","Modal","socket","WebSocket","config","name","storeName","ReactFlowRenderer","elements","setElements","setName","activeNode","setActiveNode","newName","setNewName","instance","setInstance","connected","setConnected","transform","data","getPosition","getPos","localStorage","getItem","console","log","JSON","parse","label","elementRemoveHandler","elementTobeRemoved","prev","connectHandler","params","els","type","style","stroke","animated","addRectangleHandler","newNode","id","Date","now","position","x","Math","random","window","innerWidth","y","innerHeight","addCircleHandler","addTriangleHandler","addTextHandler","edgeUpdateHandler","oldEdge","newConnection","clickHandler","e","htmlString","target","outerHTML","toString","index","indexOf","currentId","substr","forEach","_current","updateNodeHandler","map","onLoad","reactFlowInstance","fitView","onRestore","restoreFlow","flow","zoom","onopen","onmessage","event","msg","setItem","stringify","signalSocket","saveChangesHandler","getElements","pos","send","onclose","wasClean","code","reason","onerror","height","width","border","marginLeft","strokeWidth","node","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport \"./styles.css\";\r\nimport ReactFlow, {\r\n    removeElements,\r\n    updateEdge,\r\n    addEdge,\r\n    Background,\r\n    MiniMap,\r\n    Controls,\r\n    useZoomPanHelper\r\n} from 'react-flow-renderer';\r\nimport localforage from 'localforage';\r\n\r\nimport { nodeTypes } from './Nodes';\r\nimport styleConnect from './style-connect';\r\nimport Message from '../messages/message'\r\nimport { Modal } from 'bootstrap';\r\n\r\nconst socket = new WebSocket('ws://localhost:5000/', \"protocolOne\");\r\n\r\nlocalforage.config({\r\n    name: 'react-flow-docs',\r\n    storeName: 'flows'\r\n})\r\n\r\nconst ReactFlowRenderer = () => {\r\n    const [ elements, setElements] = useState([styleConnect]);\r\n    const [ name, setName] = useState(\"\");\r\n    const [ activeNode, setActiveNode] = useState();\r\n    const [ newName, setNewName] = useState(\"\");\r\n    const [ instance, setInstance] = useState();\r\n    const [ connected, setConnected ] = useState(false);\r\n    const { transform } = useZoomPanHelper();\r\n    //const [ nodes, setNodes, onNodesChange ] = useNodesState(initialNodes);\r\n\r\n    const data = 'example-flow';\r\n\r\n    //получение данных с localStorage\r\n    const getPosition = () => {\r\n        const getPos = localStorage.getItem(\"Position\");\r\n        console.log('Position', JSON.parse(getPos));\r\n        //this.setState({ activeNode: JSON.parse(getPos)})\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (activeNode) setNewName(activeNode.data.label);\r\n    }, [activeNode]);\r\n\r\n    const elementRemoveHandler = (elementTobeRemoved) => {\r\n        setElements((prev) => removeElements(elementTobeRemoved, prev));\r\n    };\r\n\r\n    const connectHandler = (params) => {\r\n        setElements((els) =>\r\n            addEdge({ ...params, type: 'smoothstep', style: { stroke: '#FF0000' }, animated: true }, els))\r\n    };\r\n\r\n    const addRectangleHandler = () => {\r\n        const newNode = {\r\n            id: `${Date.now()}`,\r\n            data: { label: `${name}` },\r\n            type: \"rectangle\",\r\n            position: {\r\n                x: Math.random() * window.innerWidth,\r\n                y: Math.random() * window.innerHeight\r\n            }\r\n        };\r\n        newNode.data = { ...newNode.data, id: `${newNode.id}` };\r\n\r\n        setElements((prev) => {\r\n            return [...prev, newNode];\r\n        });\r\n        setName(\"\");\r\n    };\r\n\r\n    const addCircleHandler = () => {\r\n        const newNode = {\r\n            id: `${Date.now()}`,\r\n            data: { label: `${name}` },\r\n            type: \"circle\",\r\n            position: {\r\n                x: Math.random() * window.innerWidth,\r\n                y: Math.random() * window.innerHeight\r\n            }\r\n        };\r\n        newNode.data = { ...newNode.data, id: `${newNode.id}` };\r\n\r\n        setElements((prev) => {\r\n            return [...prev, newNode];\r\n        });\r\n        setName(\"\");\r\n    };\r\n\r\n    const addTriangleHandler = () => {\r\n        const newNode = {\r\n            id: `${Date.now()}`,\r\n            data: { label: `${name}` },\r\n            type: \"triangle\",\r\n            position: {\r\n                x: Math.random() * window.innerWidth,\r\n                y: Math.random() * window.innerHeight\r\n            }\r\n        };\r\n        newNode.data = { ...newNode.data, id: `${newNode.id}` };\r\n        setElements((prev) => {\r\n            return [...prev, newNode];\r\n        });\r\n        setName(\"\");\r\n\r\n    };\r\n\r\n    const addTextHandler = () => {\r\n        const newNode = {\r\n            id: `${Date.now()}`,\r\n            data: { label: `${name}` },\r\n            type: \"text\",\r\n            position: {\r\n                x: 0,\r\n                y: 0\r\n            }\r\n        };\r\n        newNode.data = { ...newNode.data, id: `${newNode.id}` };\r\n\r\n        setElements((prev) => {\r\n            return [...prev, newNode];\r\n        });\r\n        setName(\"\");\r\n    };\r\n\r\n    const edgeUpdateHandler = (oldEdge, newConnection) =>\r\n        setElements((els) => updateEdge(oldEdge, newConnection, els));\r\n\r\n    const clickHandler = (e) => {\r\n        var htmlString = e.target.outerHTML.toString();\r\n        var index = htmlString.indexOf(` id=\"`);\r\n        index += 5;\r\n        const currentId = htmlString.substr(index, 13);\r\n\r\n        elements.forEach((_current) => {\r\n            if (_current.id === currentId) {\r\n                setActiveNode(_current);\r\n            }\r\n        });\r\n        // setNewName(activeNode.data.label)\r\n    };\r\n\r\n    const updateNodeHandler = () => {\r\n        if (!activeNode) return;\r\n        setElements(\r\n            elements.map((_current) => {\r\n                if (_current.id === activeNode.id) {\r\n                    return {\r\n                        ..._current,\r\n                        data: { label: newName, id: _current.data.id }\r\n                    };\r\n                }\r\n                return _current;\r\n            })\r\n        );\r\n    };\r\n\r\n    const onLoad = (reactFlowInstance) => {\r\n        setInstance(reactFlowInstance);\r\n        reactFlowInstance.fitView();\r\n    };\r\n\r\n    const onRestore = useCallback(() => {\r\n        const restoreFlow = async () => {\r\n            const flow = await localforage.getItem(position);\r\n\r\n            if(flow){\r\n                const[x = 0, y = 0] = flow.position;\r\n                setElements(flow.elements || []);\r\n                transform({ x, y, zoom: flow.zoom || 0});\r\n            }\r\n        };\r\n        restoreFlow();\r\n    }, [setElements, transform]);\r\n\r\n\r\n    socket.onopen = () => {\r\n        setConnected(true);\r\n        console.log('подключено');\r\n    }\r\n\r\n    /*\r\n    socket.onmessage = (event) => {\r\n        console.log('есть сообщение')\r\n        const lineSignal = JSON.parse(event.data);\r\n        console.log(lineSignal);\r\n        let linedate = event.data;\r\n        console.log(linedate);\r\n        let json = JSON.stringify(linedate);\r\n        console.log(json);\r\n        let fileName = 'signal.json'\r\n\r\n        let fileToSave = new Blob([JSON.stringify(json, null, 4)], {\r\n            type: 'application/json',\r\n            name: fileName\r\n        })\r\n        saveAs (fileToSave, fileName);\r\n    }\r\n    */\r\n\r\n    socket.onmessage = (event) => {\r\n        let msg = JSON.parse(event.data);\r\n        console.log('есть сообщение')\r\n        console.log(msg);\r\n        localStorage.setItem(\"data\", JSON.stringify(msg));\r\n    };\r\n    const signalSocket = (msg) => {\r\n        console.log(signalSocket.msg);\r\n        console.log(signalSocket.msg);\r\n        console.log(signalSocket.msg);\r\n    }\r\n    \r\n\r\n    //save pos\r\n    const saveChangesHandler = () => {\r\n        console.log(\"state\", instance.getElements());\r\n        //сохранение в локальное хранилище\r\n        //localStorage.setItem('Position', JSON.stringify(instance.getElements()));\r\n        localforage.setItem(position, JSON.stringify(instance.getElements()));\r\n        //отправка json\r\n        let pos = JSON.stringify(instance.getElements());\r\n        socket.send(pos);\r\n    }\r\n\r\n    socket.onclose = function (event) {\r\n        if (event.wasClean) {\r\n            console.log('Соединение закрыто чисто')\r\n        } else {\r\n            console.log('Обрыв соединения')\r\n        }\r\n        console.log('Код: ' + event.code + ' причина: ' + event.reason)\r\n    }\r\n\r\n    socket.onerror = function (event) {\r\n        console.log(event);\r\n    }\r\n\r\n\r\n    return (\r\n        <div\r\n            style={{\r\n                height: \"75vh\",\r\n                width: \"75vw\",\r\n                border: \"1px solid black\",\r\n                marginLeft: \"12.5vw\"\r\n            }}\r\n        >\r\n            <ReactFlow\r\n                elements={elements}\r\n                onElementsRemove={elementRemoveHandler}\r\n                onConnect={connectHandler}\r\n                deleteKeyCode={8 || 46}\r\n                onEdgeUpdate={edgeUpdateHandler}\r\n                nodeTypes={nodeTypes}\r\n                snapToGrid={true}\r\n                snapGrid={[16, 16]}\r\n                connectionLineStyle={{ stroke: \"black\", strokeWidth: 2 }}\r\n                onDoubleClick={clickHandler}\r\n                onLoad={onLoad}\r\n            >\r\n                <Background variant=\"dots\" gap={15} size={2} color=\"#c8c8c8\" />\r\n\r\n                <MiniMap\r\n                    nodeColor={(node) => {\r\n                        switch (node.type) {\r\n                            case \"rectangle\":\r\n                                return \"red\";\r\n                            case \"circle\":\r\n                                return \"#00ff00\";\r\n                            case \"triangle\":\r\n                                return \"rgb(0,0,255)\";\r\n                            default:\r\n                                return \"#eee\";\r\n                        }\r\n                    }}\r\n                />\r\n\r\n                <Controls />\r\n            </ReactFlow>\r\n\r\n            <div>\r\n                <input\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    type=\"text\"\r\n                    placeholder=\"Enter new node name\"\r\n                />\r\n\r\n                <button type=\"button\" onClick={addRectangleHandler}>\r\n                    Create Rectangle\r\n                </button>\r\n\r\n                <button type=\"button\" onClick={addCircleHandler}>\r\n                    Create Circle\r\n                </button>\r\n\r\n                <button type=\"button\" onClick={addTriangleHandler}>\r\n                    Create Triangle\r\n                </button>\r\n\r\n                <button type=\"button\" onClick={addTextHandler}>\r\n                    Plain text\r\n                </button>\r\n            </div>\r\n\r\n            <div>\r\n                <input\r\n                    value={newName}\r\n                    onChange={(e) => setNewName(e.target.value)}\r\n                    type=\"text\"\r\n                />\r\n\r\n                <button type=\"button\" onClick={updateNodeHandler}>\r\n                    Обновить состояние фигуры\r\n                </button>\r\n            </div>\r\n            <div>\r\n                <button type=\"button\" onClick={saveChangesHandler}>\r\n                    Сохранение\r\n                </button>\r\n                <button type=\"button\" onClick={onRestore}>\r\n                    Загрузка\r\n                </button>\r\n                {/* Сделать кнопку которая открывает модальное окно modal.jsx */}\r\n                <Message/>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ReactFlowRenderer;"]},"metadata":{},"sourceType":"module"}